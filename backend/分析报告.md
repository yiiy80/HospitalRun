# HospitalRun åç«¯ç³»ç»Ÿåˆ†ææŠ¥å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2025-12-10
**åˆ†æå¯¹è±¡**: hospital/backend ç›®å½•
**æŠ€æœ¯æ ˆ**: FastAPI + SQLAlchemy + MySQL

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—åˆ†æ](#æ ¸å¿ƒæ¨¡å—åˆ†æ)
4. [APIæ¥å£è®¾è®¡](#apiæ¥å£è®¾è®¡)
5. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
6. [å®‰å…¨æ€§åˆ†æ](#å®‰å…¨æ€§åˆ†æ)
7. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
8. [æµ‹è¯•è¦†ç›–](#æµ‹è¯•è¦†ç›–)
9. [ä¼˜åŠ¿ä¸ç‰¹ç‚¹](#ä¼˜åŠ¿ä¸ç‰¹ç‚¹)
10. [å­˜åœ¨çš„é—®é¢˜](#å­˜åœ¨çš„é—®é¢˜)
11. [æ”¹è¿›å»ºè®®](#æ”¹è¿›å»ºè®®)
12. [æ€»ä½“è¯„ä»·](#æ€»ä½“è¯„ä»·)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
HospitalRun åç«¯æ˜¯ä¸€ä¸ªåŸºäº FastAPI æ¡†æ¶å¼€å‘çš„åŒ»é™¢ç®¡ç†ç³»ç»Ÿ RESTful API æœåŠ¡ï¼Œä¸ºå‰ç«¯ React åº”ç”¨æä¾›å®Œæ•´çš„æ•°æ®äº¤äº’æ¥å£ã€‚

### 1.2 æŠ€æœ¯é€‰å‹

| æŠ€æœ¯ç»„ä»¶ | ç‰ˆæœ¬ | ç”¨é€” |
|---------|------|------|
| FastAPI | 0.104.1 | Web æ¡†æ¶ |
| Uvicorn | 0.24.0 | ASGI æœåŠ¡å™¨ |
| SQLAlchemy | 2.0.23 | ORM æ¡†æ¶ |
| Pydantic | 2.5.0 | æ•°æ®éªŒè¯ |
| MySQL Connector | 8.2.0 | æ•°æ®åº“é©±åŠ¨ |
| Python Jose | 3.3.0 | JWT è®¤è¯ï¼ˆå·²å®‰è£…æœªä½¿ç”¨ï¼‰ |
| Passlib | 1.7.4 | å¯†ç åŠ å¯†ï¼ˆå·²å®‰è£…æœªä½¿ç”¨ï¼‰ |

### 1.3 åŠŸèƒ½èŒƒå›´
- **æ‚£è€…ç®¡ç†**: æ‚£è€…ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥ã€åˆ†é¡µæœç´¢
- **åŒ»ç”Ÿç®¡ç†**: åŒ»ç”Ÿä¿¡æ¯ç®¡ç†ã€ä¸“ä¸šç§‘å®¤åˆ†ç±»
- **é¢„çº¦ç®¡ç†**: é¢„çº¦åˆ›å»ºã€çŠ¶æ€è·Ÿè¸ªã€æ—¶é—´ç­›é€‰
- **ä»ªè¡¨ç›˜**: ç»Ÿè®¡æ•°æ®èšåˆã€å®æ—¶ç›‘æ§

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 é¡¹ç›®ç»“æ„

```
/backend
â”œâ”€â”€ main.py                 # åº”ç”¨å…¥å£ï¼Œè·¯ç”±æ³¨å†Œï¼Œä¸­é—´ä»¶é…ç½®
â”œâ”€â”€ database.py            # æ•°æ®åº“è¿æ¥ç®¡ç†
â”œâ”€â”€ models.py              # SQLAlchemy ORM æ¨¡å‹
â”œâ”€â”€ schemas.py             # Pydantic æ•°æ®éªŒè¯æ¨¡å¼
â”œâ”€â”€ crud.py                # æ•°æ®åº“ CRUD æ“ä½œå°è£…
â”œâ”€â”€ requirements.txt       # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ pytest.ini            # æµ‹è¯•é…ç½®
â”œâ”€â”€ test.sh               # æµ‹è¯•æ‰§è¡Œè„šæœ¬
â”œâ”€â”€ test.db               # SQLite æµ‹è¯•æ•°æ®åº“
â””â”€â”€ routes/               # è·¯ç”±æ¨¡å—
    â”œâ”€â”€ patients.py       # æ‚£è€…è·¯ç”±
    â”œâ”€â”€ doctors.py        # åŒ»ç”Ÿè·¯ç”±
    â”œâ”€â”€ appointments.py   # é¢„çº¦è·¯ç”±
    â””â”€â”€ dashboard.py      # ä»ªè¡¨ç›˜è·¯ç”±
```

### 2.2 æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API Layer (Routes)             â”‚  â† FastAPI è·¯ç”±å¤„ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Validation Layer (Schemas)         â”‚  â† Pydantic æ•°æ®éªŒè¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Business Logic Layer (CRUD)        â”‚  â† ä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ORM Layer (Models)              â”‚  â† SQLAlchemy æ¨¡å‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      Database Layer (MySQL/SQLite)      â”‚  â† æ•°æ®æŒä¹…åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 è®¾è®¡æ¨¡å¼

1. **ä¾èµ–æ³¨å…¥**: é€šè¿‡ `Depends(get_db)` æ³¨å…¥æ•°æ®åº“ä¼šè¯
2. **ä»“å‚¨æ¨¡å¼**: CRUD å±‚å°è£…æ‰€æœ‰æ•°æ®è®¿é—®é€»è¾‘
3. **æ¨¡å¼-éªŒè¯åˆ†ç¦»**: Models è´Ÿè´£æ•°æ®åº“ï¼ŒSchemas è´Ÿè´£ API éªŒè¯
4. **ç»Ÿä¸€å“åº”æ ¼å¼**: SuccessResponse/ErrorResponse æ ‡å‡†åŒ– API å“åº”

---

## 3. æ ¸å¿ƒæ¨¡å—åˆ†æ

### 3.1 main.py - åº”ç”¨ä¸»å…¥å£

**åŠŸèƒ½èŒè´£**:
- FastAPI åº”ç”¨å®ä¾‹åŒ–
- CORS è·¨åŸŸé…ç½®ï¼ˆå…è®¸ localhost:3000ï¼‰
- å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- è·¯ç”±æ¨¡å—æ³¨å†Œ
- æ•°æ®åº“è¡¨è‡ªåŠ¨åˆ›å»ºï¼ˆå¯åŠ¨æ—¶ï¼‰

**å…³é”®ä»£ç åˆ†æ**:

```python
# CORS é…ç½®
allow_origins=["http://localhost:3000", "http://127.0.0.1:3000"]
```
âœ… **ä¼˜ç‚¹**: æ˜ç¡®é™åˆ¶æ¥æºåŸŸï¼Œæé«˜å®‰å…¨æ€§
âš ï¸ **é£é™©**: ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®ä¸ºå®é™…éƒ¨ç½²åŸŸå

```python
@app.on_event("startup")
async def create_tables():
    Base.metadata.create_all(bind=engine)
```
âœ… **ä¼˜ç‚¹**: è‡ªåŠ¨å»ºè¡¨ï¼Œå¼€å‘ä¾¿æ·
âš ï¸ **é£é™©**: ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨ Alembic è¿›è¡Œæ•°æ®åº“è¿ç§»

### 3.2 database.py - æ•°æ®åº“è¿æ¥

**é…ç½®æ–¹å¼**:
```python
DATABASE_URL = os.getenv(
    "DATABASE_URL",
    "mysql+mysqlconnector://root:123654@localhost/hospital_management"
)
```

âœ… **ä¼˜ç‚¹**: æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
âŒ **é—®é¢˜**: é»˜è®¤ç¡¬ç¼–ç äº†æ•°æ®åº“å¯†ç ï¼ˆå®‰å…¨éšæ‚£ï¼‰
ğŸ”§ **å»ºè®®**: å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯

**è¿æ¥æ± é…ç½®**:
```python
engine = create_engine(DATABASE_URL, echo=True)
```
âš ï¸ **é—®é¢˜**:
- `echo=True` åœ¨ç”Ÿäº§ç¯å¢ƒä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—
- æœªé…ç½®è¿æ¥æ± å‚æ•°ï¼ˆpool_size, max_overflowï¼‰

### 3.3 models.py - æ•°æ®æ¨¡å‹

#### 3.3.1 Patient æ¨¡å‹

```python
class Patient(Base):
    __tablename__ = "patients"

    id = Column(Integer, primary_key=True, autoincrement=True)
    name = Column(String(100), nullable=False)
    age = Column(Integer, nullable=False)
    gender = Column(Enum('ç”·', 'å¥³'), nullable=False)
    medical_condition = Column(Text, nullable=False)
    created_at = Column(DateTime, default=func.now())
    updated_at = Column(DateTime, default=func.now(), onupdate=func.now())
```

âœ… **ä¼˜ç‚¹**:
- å­—æ®µæ³¨é‡Šå®Œæ•´ï¼ˆcommentå‚æ•°ï¼‰
- è‡ªåŠ¨æ—¶é—´æˆ³
- æšä¸¾çº¦æŸæ€§åˆ«å­—æ®µ

âŒ **é—®é¢˜**:
- ç¼ºå°‘ç´¢å¼•ï¼ˆnameã€phone ç­‰å¸¸æŸ¥è¯¢å­—æ®µï¼‰
- å¹´é¾„å­—æ®µæœªè®¾ç½®èŒƒå›´çº¦æŸ

#### 3.3.2 Doctor æ¨¡å‹

```python
specialty = Column(Enum('å†…ç§‘', 'å¤–ç§‘', 'å„¿ç§‘', 'å¦‡äº§ç§‘', 'çœ¼ç§‘', 'å£è…”ç§‘'))
status = Column(Enum('åœ¨èŒ', 'ä¼‘æ¯ä¸­', 'ç¦»èŒ'), default='åœ¨èŒ')
```

âœ… **ä¼˜ç‚¹**:
- ä¸“ä¸šç§‘å®¤å—æ§æšä¸¾
- çŠ¶æ€å­—æ®µæœ‰é»˜è®¤å€¼

âš ï¸ **é—®é¢˜**:
- ç§‘å®¤åˆ—è¡¨ç¡¬ç¼–ç ï¼Œæ‰©å±•æ€§å·®
- ç¼ºå°‘ phone å­—æ®µçš„å”¯ä¸€æ€§çº¦æŸ

#### 3.3.3 Appointment æ¨¡å‹

```python
status = Column(Enum('pending', 'confirmed', 'cancelled'), default='pending')
appointment_time = Column(DateTime, nullable=False)
```

âœ… **ä¼˜ç‚¹**: çŠ¶æ€ç®¡ç†æ¸…æ™°
âŒ **ä¸¥é‡é—®é¢˜**:
- **patient_name å’Œ doctor_name ä½¿ç”¨å­—ç¬¦ä¸²è€Œéå¤–é”®**
- ç¼ºå°‘ ON DELETE CASCADE ç­‰å¼•ç”¨å®Œæ•´æ€§çº¦æŸ
- æ— æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§

### 3.4 schemas.py - æ•°æ®éªŒè¯

#### éªŒè¯ç­–ç•¥åˆ†æ

**æ‚£è€…éªŒè¯**:
```python
age: int = Field(..., ge=0, le=150, description="å¹´é¾„")
gender: GenderEnum = Field(..., description="æ€§åˆ«")
```
âœ… å¹´é¾„èŒƒå›´éªŒè¯ã€æšä¸¾çº¦æŸ

**é¢„çº¦æ—¶é—´éªŒè¯**:
```python
class AppointmentCreate(AppointmentBase):
    @validator('appointment_time')
    def validate_appointment_time_future(cls, v):
        if v < datetime.now():
            raise ValueError('é¢„çº¦æ—¶é—´å¿…é¡»æ˜¯æœªæ¥çš„æ—¶é—´')
        return v
```
âœ… **ä¼˜ç§€è®¾è®¡**: åˆ›å»ºæ—¶å¼ºåˆ¶æœªæ¥æ—¶é—´ï¼Œç¼–è¾‘æ—¶å…è®¸è¿‡å»æ—¶é—´

**æšä¸¾è®¾è®¡**:
```python
class GenderEnum(str, Enum):
    male = "ç”·"
    female = "å¥³"
```
âœ… ä½¿ç”¨ä¸­æ–‡æšä¸¾å€¼ï¼Œç¬¦åˆä¸šåŠ¡éœ€æ±‚

### 3.5 crud.py - ä¸šåŠ¡é€»è¾‘

#### 3.5.1 æŸ¥è¯¢ä¼˜åŒ–

**æ‚£è€…æœç´¢**:
```python
query = query.filter(
    or_(
        Patient.name.contains(search),
        Patient.phone.contains(search),
        Patient.medical_condition.contains(search)
    )
)
```
âœ… æ”¯æŒå¤šå­—æ®µæ¨¡ç³Šæœç´¢
âš ï¸ **æ€§èƒ½é—®é¢˜**: `contains` ä½¿ç”¨ LIKE æŸ¥è¯¢ï¼Œå¤§æ•°æ®é‡ä¸‹æ€§èƒ½å·®

**åˆ†é¡µå®ç°**:
```python
total = query.count()
patients = query.offset(skip).limit(limit).all()
```
âœ… æ ‡å‡†åˆ†é¡µ
âš ï¸ **æ€§èƒ½é—®é¢˜**: count() å’Œ æŸ¥è¯¢åˆ†å¼€æ‰§è¡Œï¼Œå¯èƒ½æ•°æ®ä¸ä¸€è‡´

#### 3.5.2 é¢„çº¦å¢å¼ºæ•°æ®

```python
# è·å–æ‚£è€…ä¿¡æ¯
patient_info = db.query(Patient).filter(
    Patient.name == appointment.patient_name
).first()
```
âŒ **ä¸¥é‡æ€§èƒ½é—®é¢˜**:
- **N+1 æŸ¥è¯¢é—®é¢˜**: å¾ªç¯å†…æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
- åº”è¯¥ä½¿ç”¨ JOIN æˆ–é¢„åŠ è½½

### 3.6 routes - API è·¯ç”±

#### è·¯ç”±è®¾è®¡æ¨¡å¼

æ‰€æœ‰è·¯ç”±æ¨¡å—éµå¾ªç»Ÿä¸€æ¨¡å¼:
```python
router = APIRouter(
    prefix="/patients",
    tags=["patients"],
    responses={404: {"description": "Not found"}}
)
```

âœ… **ä¼˜ç‚¹**:
- RESTful é£æ ¼ç»Ÿä¸€
- è‡ªåŠ¨ API æ–‡æ¡£åˆ†ç±»ï¼ˆtagsï¼‰
- ä¾èµ–æ³¨å…¥ç®¡ç†æ•°æ®åº“ä¼šè¯

âŒ **é—®é¢˜**:
- ç¼ºå°‘è®¤è¯æˆæƒä¸­é—´ä»¶
- ç¼ºå°‘è¯·æ±‚é™æµ
- æ— å®¡è®¡æ—¥å¿—

---

## 4. APIæ¥å£è®¾è®¡

### 4.1 æ¥å£æ¸…å•

| æ¨¡å— | æ–¹æ³• | ç«¯ç‚¹ | åŠŸèƒ½ |
|-----|------|------|------|
| **æ‚£è€…** | POST | /api/patients/ | åˆ›å»ºæ‚£è€… |
|  | GET | /api/patients/{id} | è·å–æ‚£è€…è¯¦æƒ… |
|  | GET | /api/patients/ | æ‚£è€…åˆ—è¡¨ï¼ˆåˆ†é¡µ+æœç´¢ï¼‰ |
|  | PUT | /api/patients/{id} | æ›´æ–°æ‚£è€… |
|  | DELETE | /api/patients/{id} | åˆ é™¤æ‚£è€… |
| **åŒ»ç”Ÿ** | POST | /api/doctors/ | åˆ›å»ºåŒ»ç”Ÿ |
|  | GET | /api/doctors/{id} | è·å–åŒ»ç”Ÿè¯¦æƒ… |
|  | GET | /api/doctors/ | åŒ»ç”Ÿåˆ—è¡¨ï¼ˆç­›é€‰ï¼‰ |
|  | PUT | /api/doctors/{id} | æ›´æ–°åŒ»ç”Ÿ |
|  | DELETE | /api/doctors/{id} | åˆ é™¤åŒ»ç”Ÿ |
| **é¢„çº¦** | POST | /api/appointments/ | åˆ›å»ºé¢„çº¦ |
|  | GET | /api/appointments/{id} | è·å–é¢„çº¦è¯¦æƒ… |
|  | GET | /api/appointments/ | é¢„çº¦åˆ—è¡¨ï¼ˆç­›é€‰ï¼‰ |
|  | PUT | /api/appointments/{id} | æ›´æ–°é¢„çº¦ |
|  | DELETE | /api/appointments/{id} | åˆ é™¤é¢„çº¦ |
| **ä»ªè¡¨ç›˜** | GET | /api/dashboard/ | ç»Ÿè®¡æ•°æ® |
| **å¥åº·æ£€æŸ¥** | GET | /health | æœåŠ¡å¥åº·æ£€æŸ¥ |

### 4.2 å“åº”æ ¼å¼

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {...},
  "message": "æ“ä½œæˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "æ•°æ®éªŒè¯å¤±è´¥",
    "details": [...]
  }
}
```

âœ… **ä¼˜ç‚¹**: ç»Ÿä¸€çš„å“åº”æ ¼å¼ä¾¿äºå‰ç«¯å¤„ç†

### 4.3 æŸ¥è¯¢å‚æ•°

**æ‚£è€…åˆ—è¡¨**:
- `page`: é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆ1-100ï¼Œé»˜è®¤10ï¼‰
- `search`: æœç´¢å…³é”®è¯
- `gender`: æ€§åˆ«ç­›é€‰

**é¢„çº¦åˆ—è¡¨**:
- `date_from`: å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- `date_to`: ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- `status`: é¢„çº¦çŠ¶æ€
- `doctor`: åŒ»ç”Ÿå§“å
- `patient`: æ‚£è€…å§“å

âœ… **ä¼˜ç‚¹**: æŸ¥è¯¢å‚æ•°ä¸°å¯Œï¼Œæ»¡è¶³ä¸šåŠ¡éœ€æ±‚

---

## 5. æ•°æ®æ¨¡å‹

### 5.1 è¡¨ç»“æ„åˆ†æ

#### patients è¡¨
```sql
CREATE TABLE patients (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    age INT NOT NULL,
    gender ENUM('ç”·', 'å¥³') NOT NULL,
    phone VARCHAR(20),
    address TEXT,
    medical_condition TEXT NOT NULL,
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**ç¼ºå°‘çš„ç´¢å¼•**:
```sql
CREATE INDEX idx_patient_name ON patients(name);
CREATE INDEX idx_patient_phone ON patients(phone);
CREATE INDEX idx_patient_created_at ON patients(created_at);
```

#### doctors è¡¨
```sql
CREATE TABLE doctors (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    specialty ENUM('å†…ç§‘', 'å¤–ç§‘', 'å„¿ç§‘', 'å¦‡äº§ç§‘', 'çœ¼ç§‘', 'å£è…”ç§‘') NOT NULL,
    experience VARCHAR(50) NOT NULL,
    phone VARCHAR(20),
    status ENUM('åœ¨èŒ', 'ä¼‘æ¯ä¸­', 'ç¦»èŒ') DEFAULT 'åœ¨èŒ',
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**ç¼ºå°‘çš„ç´¢å¼•**:
```sql
CREATE INDEX idx_doctor_specialty ON doctors(specialty);
CREATE INDEX idx_doctor_status ON doctors(status);
CREATE UNIQUE INDEX idx_doctor_phone ON doctors(phone);
```

#### appointments è¡¨
```sql
CREATE TABLE appointments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    patient_name VARCHAR(100) NOT NULL,  -- âš ï¸ åº”è¯¥æ˜¯å¤–é”®
    doctor_name VARCHAR(100) NOT NULL,   -- âš ï¸ åº”è¯¥æ˜¯å¤–é”®
    appointment_time DATETIME NOT NULL,
    status ENUM('pending', 'confirmed', 'cancelled') DEFAULT 'pending',
    reason TEXT,
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**âŒ ä¸¥é‡è®¾è®¡ç¼ºé™·**:
```sql
-- åº”è¯¥æ”¹ä¸º:
patient_id INT NOT NULL,
doctor_id INT NOT NULL,
FOREIGN KEY (patient_id) REFERENCES patients(id) ON DELETE CASCADE,
FOREIGN KEY (doctor_id) REFERENCES doctors(id) ON DELETE CASCADE,
CREATE INDEX idx_appointment_time ON appointments(appointment_time),
CREATE INDEX idx_appointment_status ON appointments(status)
```

### 5.2 æ•°æ®å®Œæ•´æ€§é—®é¢˜

| é—®é¢˜ | å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|-----|------|---------|
| é¢„çº¦è¡¨æ— å¤–é”®çº¦æŸ | æ•°æ®å­¤å„¿è®°å½•ã€ä¸€è‡´æ€§æ— æ³•ä¿è¯ | ğŸ”´ é«˜ |
| ç¼ºå°‘å”¯ä¸€æ€§çº¦æŸ | å¯èƒ½é‡å¤æ•°æ®ï¼ˆå¦‚åŒ»ç”Ÿæ‰‹æœºå·ï¼‰ | ğŸŸ¡ ä¸­ |
| ç¼ºå°‘ç´¢å¼• | æŸ¥è¯¢æ€§èƒ½å·® | ğŸŸ¡ ä¸­ |
| è½¯åˆ é™¤æœºåˆ¶ç¼ºå¤± | æ— æ³•è¿½è¸ªå†å²æ•°æ® | ğŸŸ¡ ä¸­ |

---

## 6. å®‰å…¨æ€§åˆ†æ

### 6.1 å·²å®ç°çš„å®‰å…¨æªæ–½

âœ… **CORS é…ç½®**: é™åˆ¶è·¨åŸŸè¯·æ±‚æ¥æº
âœ… **æ•°æ®éªŒè¯**: Pydantic ä¸¥æ ¼éªŒè¯è¾“å…¥
âœ… **æšä¸¾çº¦æŸ**: æ•°æ®åº“å±‚é¢é™åˆ¶å­—æ®µå€¼
âœ… **å‚æ•°åŒ–æŸ¥è¯¢**: SQLAlchemy ORM é˜²æ­¢ SQL æ³¨å…¥

### 6.2 å®‰å…¨éšæ‚£

| é—®é¢˜ | æè¿° | é£é™©çº§åˆ« |
|-----|------|---------|
| **æ— è®¤è¯æœºåˆ¶** | API å®Œå…¨å¼€æ”¾ï¼Œä»»ä½•äººå¯è®¿é—® | ğŸ”´ ä¸¥é‡ |
| **ç¡¬ç¼–ç å¯†ç ** | database.py ä¸­æ˜æ–‡å¯†ç  | ğŸ”´ ä¸¥é‡ |
| **æ— æˆæƒæ§åˆ¶** | ç¼ºå°‘è§’è‰²æƒé™ç®¡ç† | ğŸ”´ ä¸¥é‡ |
| **æ— è¯·æ±‚é™æµ** | æ˜“é­å— DDoS æ”»å‡» | ğŸŸ  é«˜ |
| **æ— å®¡è®¡æ—¥å¿—** | æ— æ³•è¿½è¸ªæ“ä½œè®°å½• | ğŸŸ  é«˜ |
| **è°ƒè¯•æ¨¡å¼** | echo=True æ³„éœ² SQL è¯­å¥ | ğŸŸ¡ ä¸­ |
| **æ•æ„Ÿä¿¡æ¯** | é”™è¯¯å“åº”å¯èƒ½æš´éœ²å†…éƒ¨ä¿¡æ¯ | ğŸŸ¡ ä¸­ |

### 6.3 å®‰å…¨å»ºè®®

```python
# 1. æ·»åŠ  JWT è®¤è¯
from fastapi.security import HTTPBearer

security = HTTPBearer()

@router.get("/patients/")
async def read_patients(
    credentials: HTTPAuthorizationCredentials = Security(security)
):
    # éªŒè¯ token
    pass

# 2. ç¯å¢ƒå˜é‡ç®¡ç†
from decouple import config

DATABASE_URL = config('DATABASE_URL')

# 3. è¯·æ±‚é™æµ
from slowapi import Limiter

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter

@router.get("/patients/")
@limiter.limit("5/minute")
async def read_patients():
    pass
```

---

## 7. æ€§èƒ½ä¼˜åŒ–

### 7.1 å½“å‰æ€§èƒ½ç“¶é¢ˆ

#### 7.1.1 N+1 æŸ¥è¯¢é—®é¢˜

**ä½ç½®**: `crud.py:174-205`

```python
for appointment in appointments:
    # å¾ªç¯å†…æ‰§è¡ŒæŸ¥è¯¢ âŒ
    patient_info = db.query(Patient).filter(...).first()
    doctor_info = db.query(Doctor).filter(...).first()
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# ä½¿ç”¨ JOIN æˆ– IN æŸ¥è¯¢
patient_names = [a.patient_name for a in appointments]
patients = db.query(Patient).filter(Patient.name.in_(patient_names)).all()
patient_map = {p.name: p for p in patients}
```

#### 7.1.2 ç¼ºå°‘æŸ¥è¯¢ç´¢å¼•

**å½±å“**:
- æ‚£è€…å§“åæœç´¢: å…¨è¡¨æ‰«æ
- é¢„çº¦æ—¶é—´èŒƒå›´æŸ¥è¯¢: å…¨è¡¨æ‰«æ
- åŒ»ç”Ÿä¸“ä¸šç­›é€‰: å…¨è¡¨æ‰«æ

**è§£å†³æ–¹æ¡ˆ**:
```python
# åœ¨ models.py ä¸­æ·»åŠ 
class Patient(Base):
    __table_args__ = (
        Index('idx_name', 'name'),
        Index('idx_phone', 'phone'),
    )
```

#### 7.1.3 ç»Ÿè®¡æŸ¥è¯¢æ•ˆç‡ä½

**ä½ç½®**: `crud.py:273-338`

```python
# Dashboard å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“
total_patients = db.query(Patient).count()  # æŸ¥è¯¢1
total_doctors = db.query(Doctor).count()     # æŸ¥è¯¢2
total_appointments_today = db.query(Appointment).filter(...).count()  # æŸ¥è¯¢3
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# ä½¿ç”¨å•æ¬¡æŸ¥è¯¢ + èšåˆå‡½æ•°
from sqlalchemy import func, case

stats = db.query(
    func.count(Patient.id).label('patient_count'),
    func.count(Doctor.id).label('doctor_count')
).first()
```

### 7.2 ç¼“å­˜ç­–ç•¥ç¼ºå¤±

**å»ºè®®**:
```python
from functools import lru_cache
from cachetools import TTLCache

# åŒ»ç”Ÿåˆ—è¡¨ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
doctor_cache = TTLCache(maxsize=100, ttl=300)

@lru_cache(maxsize=128)
def get_specialty_options():
    return [e.value for e in SpecialtyEnum]
```

### 7.3 æ•°æ®åº“è¿æ¥æ± 

**å½“å‰é…ç½®**:
```python
engine = create_engine(DATABASE_URL, echo=True)  # ä½¿ç”¨é»˜è®¤é…ç½®
```

**æ¨èé…ç½®**:
```python
engine = create_engine(
    DATABASE_URL,
    echo=False,  # ç”Ÿäº§ç¯å¢ƒå…³é—­
    pool_size=10,  # è¿æ¥æ± å¤§å°
    max_overflow=20,  # æœ€å¤§æº¢å‡ºè¿æ¥æ•°
    pool_pre_ping=True,  # è¿æ¥å¥åº·æ£€æŸ¥
    pool_recycle=3600  # è¿æ¥å›æ”¶æ—¶é—´ï¼ˆç§’ï¼‰
)
```

---

## 8. æµ‹è¯•è¦†ç›–

### 8.1 æµ‹è¯•åŸºç¡€è®¾æ–½

**é…ç½®æ–‡ä»¶**: [pytest.ini](c:\hospital\hospital\backend\pytest.ini)
```ini
testpaths = tests
python_files = test_*.py
addopts = -v --tb=short
markers =
    unit: å•å…ƒæµ‹è¯•
    integration: é›†æˆæµ‹è¯•
```

**æµ‹è¯•è„šæœ¬**: [test.sh](c:\hospital\hospital\backend\test.sh)
- è‡ªåŠ¨ä¾èµ–æ£€æŸ¥
- åˆ†æ¨¡å—æµ‹è¯•
- è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ

### 8.2 æµ‹è¯•ç°çŠ¶

âœ… **å·²é…ç½®**:
- pytest æµ‹è¯•æ¡†æ¶
- pytest-asyncio å¼‚æ­¥æµ‹è¯•æ”¯æŒ
- pytest-cov è¦†ç›–ç‡ç»Ÿè®¡
- httpx ç”¨äº API æµ‹è¯•
- faker æµ‹è¯•æ•°æ®ç”Ÿæˆ

âŒ **é—®é¢˜**:
- **tests ç›®å½•ä¸å­˜åœ¨**ï¼ˆREADME ä¸­æåˆ°ä½†æœªå®ç°ï¼‰
- æ— å•å…ƒæµ‹è¯•ä»£ç 
- æ— é›†æˆæµ‹è¯•ä»£ç 

### 8.3 æµ‹è¯•å»ºè®®

#### 8.3.1 å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
# tests/test_crud.py
import pytest
from crud import get_patient
from models import Patient

def test_get_patient_exists(test_db):
    patient = Patient(name="å¼ ä¸‰", age=30, gender="ç”·", medical_condition="æ„Ÿå†’")
    test_db.add(patient)
    test_db.commit()

    result = get_patient(test_db, patient.id)
    assert result.name == "å¼ ä¸‰"

def test_get_patient_not_found(test_db):
    result = get_patient(test_db, 999)
    assert result is None
```

#### 8.3.2 API æµ‹è¯•ç¤ºä¾‹

```python
# tests/test_api_patients.py
from fastapi.testclient import TestClient

def test_create_patient(client):
    response = client.post("/api/patients/", json={
        "name": "æå››",
        "age": 25,
        "gender": "ç”·",
        "medical_condition": "ä½“æ£€"
    })
    assert response.status_code == 200
    assert response.json()["success"] == True
```

#### 8.3.3 é›†æˆæµ‹è¯•å»ºè®®

```python
# tests/test_integration.py
def test_appointment_workflow(client):
    # 1. åˆ›å»ºæ‚£è€…
    patient_resp = client.post("/api/patients/", json={...})

    # 2. åˆ›å»ºåŒ»ç”Ÿ
    doctor_resp = client.post("/api/doctors/", json={...})

    # 3. åˆ›å»ºé¢„çº¦
    appointment_resp = client.post("/api/appointments/", json={
        "patient_name": patient_resp.json()["data"]["name"],
        "doctor_name": doctor_resp.json()["data"]["name"],
        ...
    })

    # 4. éªŒè¯ä»ªè¡¨ç›˜ç»Ÿè®¡
    dashboard_resp = client.get("/api/dashboard/")
    assert dashboard_resp.json()["summary"]["total_appointments_today"] > 0
```

---

## 9. ä¼˜åŠ¿ä¸ç‰¹ç‚¹

### 9.1 æŠ€æœ¯ä¼˜åŠ¿

âœ… **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**:
- FastAPI æ€§èƒ½ä¼˜å¼‚ï¼ˆåŸºäº Starlette å’Œ Pydanticï¼‰
- è‡ªåŠ¨ç”Ÿæˆ OpenAPI æ–‡æ¡£ï¼ˆSwagger UI + ReDocï¼‰
- åŸç”Ÿæ”¯æŒå¼‚æ­¥ç¼–ç¨‹

âœ… **ä»£ç è´¨é‡**:
- ç±»å‹æ³¨è§£å®Œæ•´ï¼ˆPython 3.8+ type hintsï¼‰
- æ¨¡å—åŒ–è®¾è®¡æ¸…æ™°
- ç¬¦åˆ PEP 8 ä»£ç è§„èŒƒ

âœ… **å¼€å‘ä½“éªŒ**:
- çƒ­é‡è½½å¼€å‘æ¨¡å¼
- è¯¦ç»†çš„ API æ–‡æ¡£
- Pydantic è‡ªåŠ¨éªŒè¯å’Œåºåˆ—åŒ–

### 9.2 ä¸šåŠ¡ç‰¹ç‚¹

âœ… **åŠŸèƒ½å®Œæ•´**:
- æ‚£è€…ã€åŒ»ç”Ÿã€é¢„çº¦ä¸‰å¤§æ ¸å¿ƒä¸šåŠ¡é—­ç¯
- ä»ªè¡¨ç›˜ç»Ÿè®¡åŠŸèƒ½
- æœç´¢å’Œç­›é€‰åŠŸèƒ½é½å…¨

âœ… **æ•°æ®éªŒè¯ä¸¥æ ¼**:
- å¹´é¾„èŒƒå›´éªŒè¯ï¼ˆ0-150ï¼‰
- é¢„çº¦æ—¶é—´éªŒè¯ï¼ˆåˆ›å»ºæ—¶å¿…é¡»æœªæ¥ï¼Œç¼–è¾‘æ—¶å…è®¸è¿‡å»ï¼‰
- æšä¸¾å­—æ®µä¸¥æ ¼çº¦æŸ

âœ… **å“åº”å¼è®¾è®¡**:
- ç»Ÿä¸€çš„æˆåŠŸ/é”™è¯¯å“åº”æ ¼å¼
- ä¸°å¯Œçš„é”™è¯¯æç¤ºä¿¡æ¯

### 9.3 å¯æ‰©å±•æ€§

âœ… **è·¯ç”±æ¨¡å—åŒ–**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½æ¨¡å—
âœ… **æ•°æ®åº“æŠ½è±¡**: å¯è½»æ¾åˆ‡æ¢æ•°æ®åº“ï¼ˆå·²æ”¯æŒ MySQL å’Œ SQLiteï¼‰
âœ… **ä¾èµ–æ³¨å…¥**: ä¾¿äºå•å…ƒæµ‹è¯•å’ŒåŠŸèƒ½æ‰©å±•

---

## 10. å­˜åœ¨çš„é—®é¢˜

### 10.1 ä¸¥é‡é—®é¢˜ï¼ˆğŸ”´ å¿…é¡»ä¿®å¤ï¼‰

1. **æ•°æ®æ¨¡å‹è®¾è®¡ç¼ºé™·**
   - é¢„çº¦è¡¨ä½¿ç”¨å­—ç¬¦ä¸²è€Œéå¤–é”®å…³è”
   - ç¼ºå°‘å¼•ç”¨å®Œæ•´æ€§çº¦æŸ
   - å¯èƒ½å¯¼è‡´æ•°æ®å­¤å„¿å’Œä¸ä¸€è‡´

2. **å®‰å…¨æ¼æ´**
   - æ— è®¤è¯æˆæƒæœºåˆ¶
   - æ•°æ®åº“å¯†ç ç¡¬ç¼–ç 
   - API å®Œå…¨å¼€æ”¾è®¿é—®

3. **æ€§èƒ½ç“¶é¢ˆ**
   - N+1 æŸ¥è¯¢é—®é¢˜ï¼ˆé¢„çº¦åˆ—è¡¨æŸ¥è¯¢æ‚£è€…/åŒ»ç”Ÿä¿¡æ¯ï¼‰
   - ç¼ºå°‘æ•°æ®åº“ç´¢å¼•
   - æœªé…ç½®è¿æ¥æ± 

### 10.2 é‡è¦é—®é¢˜ï¼ˆğŸŸ  åº”è¯¥ä¿®å¤ï¼‰

1. **æµ‹è¯•ç¼ºå¤±**
   - tests ç›®å½•ä¸å­˜åœ¨
   - æ— å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
   - ä»£ç è´¨é‡æ— ä¿éšœ

2. **ç¼ºå°‘å®¡è®¡åŠŸèƒ½**
   - æ— æ“ä½œæ—¥å¿—
   - æ— æ³•è¿½è¸ªæ•°æ®å˜æ›´å†å²
   - ç¼ºå°‘è½¯åˆ é™¤æœºåˆ¶

3. **é”™è¯¯å¤„ç†ä¸å®Œå–„**
   - å…¨å±€å¼‚å¸¸å¤„ç†è¿‡äºå®½æ³›
   - ç¼ºå°‘ä¸šåŠ¡å¼‚å¸¸åˆ†ç±»
   - é”™è¯¯ä¿¡æ¯å¯èƒ½æ³„éœ²å†…éƒ¨ç»†èŠ‚

### 10.3 æ”¹è¿›å»ºè®®ï¼ˆğŸŸ¡ å¯ä¼˜åŒ–ï¼‰

1. **ç¼“å­˜æœºåˆ¶**
   - åŒ»ç”Ÿåˆ—è¡¨å¯ç¼“å­˜
   - ç§‘å®¤æšä¸¾å¯ç¼“å­˜
   - ä»ªè¡¨ç›˜ç»Ÿè®¡å¯çŸ­æ—¶ç¼“å­˜

2. **æ—¥å¿—ç³»ç»Ÿ**
   - é›†æˆç»“æ„åŒ–æ—¥å¿—ï¼ˆå¦‚ structlogï¼‰
   - æ·»åŠ è¯·æ±‚è¿½è¸ª ID
   - åŒºåˆ†ä¸åŒçº§åˆ«æ—¥å¿—

3. **ç›‘æ§å‘Šè­¦**
   - é›†æˆ Prometheus æŒ‡æ ‡
   - æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
   - æ•°æ®åº“æ…¢æŸ¥è¯¢ç›‘æ§

---

## 11. æ”¹è¿›å»ºè®®

### 11.1 çŸ­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰

#### 11.1.1 ä¿®å¤æ•°æ®æ¨¡å‹

```python
# models.py
class Appointment(Base):
    __tablename__ = "appointments"

    id = Column(Integer, primary_key=True)
    patient_id = Column(Integer, ForeignKey('patients.id', ondelete='CASCADE'), nullable=False)
    doctor_id = Column(Integer, ForeignKey('doctors.id', ondelete='CASCADE'), nullable=False)

    # æ·»åŠ å…³ç³»
    patient = relationship("Patient", backref="appointments")
    doctor = relationship("Doctor", backref="appointments")
```

#### 11.1.2 æ·»åŠ è®¤è¯

```python
# auth.py
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from jose import JWTError, jwt

security = HTTPBearer()

async def get_current_user(credentials: HTTPAuthorizationCredentials = Security(security)):
    try:
        payload = jwt.decode(credentials.credentials, SECRET_KEY, algorithms=["HS256"])
        return payload
    except JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")

# routes/patients.py
@router.get("/")
async def read_patients(
    current_user: dict = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # å¸¦è®¤è¯çš„è·¯ç”±
    pass
```

#### 11.1.3 æ·»åŠ ç´¢å¼•

```python
# models.py
class Patient(Base):
    __tablename__ = "patients"
    __table_args__ = (
        Index('idx_name', 'name'),
        Index('idx_phone', 'phone'),
        Index('idx_created_at', 'created_at'),
    )
```

### 11.2 ä¸­æœŸæ”¹è¿›ï¼ˆ1-2æœˆï¼‰

#### 11.2.1 ç¼–å†™æµ‹è¯•

```bash
# åˆ›å»ºæµ‹è¯•ç›®å½•ç»“æ„
tests/
â”œâ”€â”€ conftest.py          # pytest é…ç½®
â”œâ”€â”€ test_models.py       # æ¨¡å‹æµ‹è¯•
â”œâ”€â”€ test_crud.py         # CRUD æµ‹è¯•
â”œâ”€â”€ test_schemas.py      # éªŒè¯æµ‹è¯•
â””â”€â”€ test_api/
    â”œâ”€â”€ test_patients.py
    â”œâ”€â”€ test_doctors.py
    â””â”€â”€ test_appointments.py
```

#### 11.2.2 æ·»åŠ æ—¥å¿—

```python
# logging_config.py
import logging
from logging.handlers import RotatingFileHandler

def setup_logging():
    logger = logging.getLogger("hospitalrun")
    logger.setLevel(logging.INFO)

    handler = RotatingFileHandler(
        "logs/app.log",
        maxBytes=10485760,  # 10MB
        backupCount=10
    )

    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    handler.setFormatter(formatter)
    logger.addHandler(handler)

    return logger
```

#### 11.2.3 ä¼˜åŒ–æŸ¥è¯¢

```python
# crud.py - ä¼˜åŒ–é¢„çº¦æŸ¥è¯¢
def get_appointments(db: Session, ...):
    # ä½¿ç”¨ JOIN é¿å… N+1 æŸ¥è¯¢
    query = db.query(
        Appointment,
        Patient,
        Doctor
    ).join(
        Patient, Appointment.patient_id == Patient.id
    ).join(
        Doctor, Appointment.doctor_id == Doctor.id
    )

    return query.all()
```

### 11.3 é•¿æœŸæ”¹è¿›ï¼ˆ3-6æœˆï¼‰

#### 11.3.1 æ•°æ®åº“è¿ç§»

```bash
# ä½¿ç”¨ Alembic
alembic init alembic
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

#### 11.3.2 ç¼“å­˜ç³»ç»Ÿ

```python
# cache.py
from redis import Redis
from functools import wraps
import json

redis_client = Redis(host='localhost', port=6379, db=0)

def cache_response(expire=300):
    def decorator(func):
        @wraps(func)
        async def wrapper(*args, **kwargs):
            cache_key = f"{func.__name__}:{json.dumps(kwargs)}"
            cached = redis_client.get(cache_key)

            if cached:
                return json.loads(cached)

            result = await func(*args, **kwargs)
            redis_client.setex(cache_key, expire, json.dumps(result))
            return result
        return wrapper
    return decorator
```

#### 11.3.3 ç›‘æ§ç³»ç»Ÿ

```python
# monitoring.py
from prometheus_client import Counter, Histogram, generate_latest

REQUEST_COUNT = Counter('http_requests_total', 'Total HTTP requests', ['method', 'endpoint'])
REQUEST_DURATION = Histogram('http_request_duration_seconds', 'HTTP request duration')

@app.middleware("http")
async def monitor_requests(request: Request, call_next):
    with REQUEST_DURATION.time():
        response = await call_next(request)
        REQUEST_COUNT.labels(
            method=request.method,
            endpoint=request.url.path
        ).inc()
    return response
```

---

## 12. æ€»ä½“è¯„ä»·

### 12.1 è¯„åˆ†å¡

| è¯„ä¼°ç»´åº¦ | å¾—åˆ† | è¯´æ˜ |
|---------|------|------|
| **ä»£ç è´¨é‡** | â­â­â­â­â˜† (8/10) | ç»“æ„æ¸…æ™°ï¼Œç±»å‹æ³¨è§£å®Œæ•´ï¼Œä½†ç¼ºå°‘æµ‹è¯• |
| **æ¶æ„è®¾è®¡** | â­â­â­â˜†â˜† (6/10) | åˆ†å±‚åˆç†ï¼Œä½†æ•°æ®æ¨¡å‹æœ‰ç¼ºé™· |
| **å®‰å…¨æ€§** | â­â­â˜†â˜†â˜† (4/10) | ç¼ºå°‘è®¤è¯æˆæƒï¼Œæœ‰ä¸¥é‡å®‰å…¨éšæ‚£ |
| **æ€§èƒ½** | â­â­â­â˜†â˜† (6/10) | å­˜åœ¨ N+1 æŸ¥è¯¢å’Œç¼ºå°‘ç´¢å¼•é—®é¢˜ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­â˜† (8/10) | æ¨¡å—åŒ–è‰¯å¥½ï¼Œæ–‡æ¡£å®Œå–„ |
| **å¯æ‰©å±•æ€§** | â­â­â­â­â˜† (7/10) | æ˜“äºæ·»åŠ æ–°åŠŸèƒ½ï¼Œä½†éœ€è¦æ”¹è¿›æ•°æ®æ¨¡å‹ |
| **æµ‹è¯•è¦†ç›–** | â­â˜†â˜†â˜†â˜† (2/10) | é…ç½®å®Œå–„ä½†æ— å®é™…æµ‹è¯•ä»£ç  |

**ç»¼åˆè¯„åˆ†**: â­â­â­â˜†â˜† (6.0/10)

### 12.2 ä¼˜åŠ¿æ€»ç»“

1. âœ… **æŠ€æœ¯é€‰å‹ç°ä»£**: FastAPI + Pydantic + SQLAlchemy ç»„åˆä¼˜ç§€
2. âœ… **ä»£ç è§„èŒƒ**: ç¬¦åˆ Python æœ€ä½³å®è·µï¼Œç±»å‹æ³¨è§£å®Œæ•´
3. âœ… **æ–‡æ¡£å®Œå–„**: README è¯¦ç»†ï¼Œè‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
4. âœ… **åŠŸèƒ½å®Œæ•´**: æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½é½å…¨
5. âœ… **å¼€å‘ä½“éªŒ**: çƒ­é‡è½½ã€è‡ªåŠ¨éªŒè¯ã€æ¸…æ™°çš„é”™è¯¯æç¤º

### 12.3 æ ¸å¿ƒé—®é¢˜

1. âŒ **å®‰å…¨éšæ‚£ä¸¥é‡**: æ— è®¤è¯æˆæƒï¼Œå¯†ç ç¡¬ç¼–ç 
2. âŒ **æ•°æ®æ¨¡å‹ç¼ºé™·**: é¢„çº¦è¡¨ç¼ºå°‘å¤–é”®çº¦æŸ
3. âŒ **æµ‹è¯•å®Œå…¨ç¼ºå¤±**: ä»£ç è´¨é‡æ— ä¿éšœ
4. âŒ **æ€§èƒ½ä¼˜åŒ–ä¸è¶³**: N+1 æŸ¥è¯¢ã€ç¼ºå°‘ç´¢å¼•
5. âŒ **ç›‘æ§å®¡è®¡ç¼ºå¤±**: æ— æ³•è¿½è¸ªç³»ç»Ÿè¿è¡ŒçŠ¶æ€

### 12.4 é€‚ç”¨åœºæ™¯

**âœ… é€‚åˆ**:
- å¿«é€ŸåŸå‹å¼€å‘
- ä¸­å°å‹åŒ»é™¢ç®¡ç†ç³»ç»Ÿ
- å­¦ä¹  FastAPI æœ€ä½³å®è·µ
- ä½œä¸ºå‰ç«¯å¼€å‘çš„ Mock API

**âŒ ä¸é€‚åˆï¼ˆéœ€æ”¹è¿›åï¼‰**:
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼ˆå®‰å…¨é—®é¢˜ï¼‰
- å¤§è§„æ¨¡åŒ»é™¢ç³»ç»Ÿï¼ˆæ€§èƒ½é—®é¢˜ï¼‰
- éœ€è¦é«˜å¯é æ€§åœºæ™¯ï¼ˆç¼ºå°‘æµ‹è¯•ï¼‰

### 12.5 æœ€ç»ˆå»ºè®®

**ç«‹å³è¡ŒåŠ¨**:
1. ğŸ”´ æ·»åŠ  JWT è®¤è¯æˆæƒ
2. ğŸ”´ ä¿®æ”¹é¢„çº¦è¡¨ä¸ºå¤–é”®å…³è”
3. ğŸ”´ å°†æ•°æ®åº“å¯†ç ç§»è‡³ç¯å¢ƒå˜é‡

**è¿‘æœŸä¼˜åŒ–**:
1. ğŸŸ  æ·»åŠ æ•°æ®åº“ç´¢å¼•
2. ğŸŸ  ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
3. ğŸŸ  ä¼˜åŒ– N+1 æŸ¥è¯¢é—®é¢˜
4. ğŸŸ  æ·»åŠ è¯·æ±‚é™æµ

**é•¿æœŸè§„åˆ’**:
1. ğŸŸ¡ é›†æˆ Redis ç¼“å­˜
2. ğŸŸ¡ æ·»åŠ  Prometheus ç›‘æ§
3. ğŸŸ¡ ä½¿ç”¨ Alembic ç®¡ç†æ•°æ®åº“è¿ç§»
4. ğŸŸ¡ æ·»åŠ å®¡è®¡æ—¥å¿—åŠŸèƒ½

---

## ğŸ“Š é™„å½•

### A. æŠ€æœ¯å€ºåŠ¡æ¸…å•

| ç¼–å· | é—®é¢˜ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ |
|-----|------|--------|---------|
| TD-001 | æ·»åŠ  JWT è®¤è¯ | P0 | 16h |
| TD-002 | ä¿®æ”¹é¢„çº¦è¡¨å¤–é”® | P0 | 8h |
| TD-003 | ç¯å¢ƒå˜é‡é…ç½® | P0 | 2h |
| TD-004 | æ·»åŠ æ•°æ®åº“ç´¢å¼• | P1 | 4h |
| TD-005 | ç¼–å†™å•å…ƒæµ‹è¯• | P1 | 40h |
| TD-006 | ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ | P1 | 16h |
| TD-007 | æ·»åŠ è¯·æ±‚é™æµ | P2 | 8h |
| TD-008 | é›†æˆç¼“å­˜ç³»ç»Ÿ | P2 | 24h |
| TD-009 | æ·»åŠ ç›‘æ§å‘Šè­¦ | P2 | 16h |
| TD-010 | å®Œå–„æ—¥å¿—ç³»ç»Ÿ | P3 | 8h |

**æ€»è®¡**: ~142 å°æ—¶ï¼ˆçº¦ 18 ä¸ªå·¥ä½œæ—¥ï¼‰

### B. ä¾èµ–åŒ…å®‰å…¨å®¡è®¡

```bash
# æ£€æŸ¥å·²çŸ¥æ¼æ´
pip install safety
safety check -r requirements.txt

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
pip list --outdated
```

### C. æ€§èƒ½åŸºå‡†æµ‹è¯•

```python
# benchmark.py
import asyncio
from locust import HttpUser, task, between

class HospitalRunUser(HttpUser):
    wait_time = between(1, 3)

    @task
    def get_patients(self):
        self.client.get("/api/patients/")

    @task
    def get_dashboard(self):
        self.client.get("/api/dashboard/")
```

---

**æŠ¥å‘Šç”Ÿæˆ**: Claude Code
**åˆ†ææ—¶é—´**: 2025-12-10
**ä»£ç ç‰ˆæœ¬**: åŸºäºå½“å‰ backend ç›®å½•
**ä¸‹æ¬¡å¤å®¡**: å»ºè®® 1 ä¸ªæœˆåé‡æ–°è¯„ä¼°æ”¹è¿›è¿›å±•
